#!/usr/bin/env bash

export FZF_DEFAULT_OPTS='--height=20% --layout=reverse-list --border'

# Get the project for the task
project=$(task _unique project | fzf --prompt="Project: ")
[[ -z $project ]] && read -p "Project not found. Enter project name: " project

# Get all tags to be added to the task with fzf --multi
tags=$(task _unique tags | fzf --no-multi --prompt="Tags: ")
[[ -n $tags ]] && tags=$(echo "$tags" | sed 's/^/+/;s/\ /\ +/')

# Due date
echo "Due date if needed" && read -r due_response
duedate="${due_response:-}"

# Get the name of the task
echo "Task name:" && read -r task_name

# Putting it all together
printf -v create "project:%s %s due:%s %s" "$project" "$tags" "$duedate" "$task_name"
task add $create && echo "Task added successfully: $create"
